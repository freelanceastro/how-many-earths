<!DOCTYPE html>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Night Sky D3 Demo</title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<style>
body {overflow: hidden; margin: 0px;}
</style>
<body>
<script>

var width = window.innerWidth,
	height = window.innerHeight;

var projection = d3.geo.stereographic()
    .clipAngle(140)
    .scale(2000)
    .translate([width, height])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection)
	// .pointRadius(10);
	.pointRadius(function(d){
		return 1.5*(5 - d.properties.brightness);
	});

var color = d3.scale.linear()
				.domain([-2.0, 0.2, 5.5])
				.range(["blue", "white", "red"]);

var λ = d3.scale.linear()
    .domain([0, width])
    .range([-180, 180]);

var φ = d3.scale.linear()
    .domain([0, height])
    .range([90, -90]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var mapx = width/2, 
	mapy = height/2;
var dragmove = function() {
  	mapx += d3.event.dx;
	mapy += d3.event.dy;
  	projection.rotate([λ(mapx), φ(mapy)]);
  	svg.selectAll("path").attr("d", path);
};

var dragobj = d3.behavior.drag().on("drag", dragmove);

d3.json("new_stars.geojson", function(error, stars) {
	svg.append("rect")
		.attr("width", width)
		.attr("height", height)
		.attr("fill", "black");

  svg.selectAll("path")
		.data(stars)
		.enter()
		.append("path")
      	.attr("d", path)
		.attr("fill", function(d){return color(d.properties.color)});

	svg.call(dragobj);
	
	svg.selectAll("path")
		.transition()
		.delay(1000)
		.duration(1000)
		.attr("transform", "scale(0.5)");

});

</script>
